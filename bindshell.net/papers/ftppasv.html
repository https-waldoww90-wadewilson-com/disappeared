<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>

<!-- Mirrored from bindshell.net/papers/ftppasv by HTTrack Website Copier/3.x [XR&CO'2010], Fri, 28 Jan 2011 12:56:45 GMT -->
<head>
	<title>BindShell.Net: Manipulating FTP Clients Using The PASV Command</title>
	<link rel="pingback" href="http://bindshell.net/www.bindshell.net/pingback.html" />
	<link rel="stylesheet" type="text/css" media="all" href="../style/default.css" />
	<meta name="keywords" content="firefox opera konqueror ftp pasv client web browser javascript portscan banner grab time connection close fingerprint" />
</head>
<body>

<div id="banner">
<a href="../index.html"><img src="../image/logo.gif"></a>
</div>

<div id="breadcrumbs">
<a href="../index.html">Home</a> : <a href="../papers.html">Papers</a> : Manipulating FTP Clients Using The PASV Command
</div>
<div id="main">
	<div id="sidebar">
		<div class="section">
<p class="title">Index</p>
<ul>
<li><a href="../papers.html">Papers</a></li>
<li><a href="../tools.html">Tools</a></li>
</ul>
<p class="title">Users</p>
<ul>
<li><a href="../users/Dave.html">Dave</a></li>
<li><a href="../users/John.html">John</a></li>
<li><a href="../users/Mark.html">Mark</a></li>
<li><a href="../users/Wade.html">Wade</a></li>
</ul>
<p class="title">Categories</p>
<ul>
<li><a href="../archive/news.html">Site News</a> (9)</li>
<li><a href="../archive/rants.html">Rants</a> (1)</li>
<li><a href="../archive/security.html">Security</a> (10)</li>
<li><a href="../archive/events.html">Events</a> (36)</li>
<li><a href="../archive/technology.html">Technology</a> (5)</li>
</ul>
<p class="title">Archive</p>
<ul>
<li><a href="../archive/2010/December.html">December </a> (1)</li>
<li><a href="../archive/2010/November.html">November </a> (1)</li>
<li><a href="../archive/2010/October.html">October  </a> (2)</li>
<li><a href="../archive/2010/March.html">March    </a> (1)</li>
<li><a href="../archive/2010/February.html">February </a> (4)</li>
<li><a href="../archive/2009/December.html">December </a> (1)</li>
<li><a href="../archive/2009/September.html">September</a> (4)</li>
<li><a href="../archive/2009/August.html">August   </a> (1)</li>
<li><a href="../archive/2009/July.html">July     </a> (1)</li>
<li><a href="../archive/2009/June.html">June     </a> (3)</li>
<li><a href="../archive/2009/May.html">May      </a> (1)</li>
<li><a href="../archive/2009/April.html">April    </a> (2)</li>
</ul>

		</div>
<div class="footer">[ <a href="https://bindshell.net/login">Login</a> ]</div>
	</div>
	<div id="pagecontent">
<div id="toc"><strong>Contents</strong>
	<div style="margin-left: 0em;"><a href="ftppasv.html#toc1">Summary</a></div>
	<div style="margin-left: 0em;"><a href="ftppasv.html#toc2">Paper</a></div>
	<div style="margin-left: 0em;"><a href="ftppasv.html#toc3">Proof of Concept Code</a></div>
	<div style="margin-left: 0em;"><a href="ftppasv.html#toc4">Mozilla Fix Information</a></div>
	<div style="margin-left: 0em;"><a href="ftppasv.html#toc5">Bug Numbers</a></div>
	<div style="margin-left: 0em;"><a href="ftppasv.html#toc6">Some Follow Up</a></div>
</div>


<h1 id="toc0">Manipulating FTP Clients Using The PASV Command</h1>
<p><img src="ftppasv/FTP.png" class="inline-left">Author: <a href="mailto:mark@bindshell.net">mark@bindshell.net</a><br />
Published: 4th March 2007<br />
Version: 1.0</p>


<h2 id="toc1">Summary</h2>
<p>A common implementation flaw in FTP clients allows FTP servers to cause clients to connect to other hosts.  This seemly small vulnerability has some interesting consequences for web browser security.</p>

<p>This paper discusses the FTP client flaw in detail and demonstrates how it can be used to attack common web browsers such as Konqueror, Opera and Firefox.  Proof of concept code is presented that extends existing JavaScript port-scanning techniques to scan any TCP port from Firefox (even though it now implements &quot;port banning&quot; restrictions).  Because of the way the same-origin policy is applied it is also possible to perform banner-grabbing scans against arbitrary hosts.  Finally, for services that don't return a banner an alternative fingerprinting technique is demonstrated which measures the time it takes servers to close inactive TCP connections.</p>


<h2 id="toc2">Paper</h2>
<p>This paper is available in PDF format only at present: <br />
<a href="ftppasv/ftp-client-pasv-manipulation.pdf">http://bindshell.net/papers/ftppasv/ftp-client-pasv-manipulation.pdf</a></p>


<h2 id="toc3">Proof of Concept Code</h2>
<p>The code which accompanies this paper is available here:<br />
<a href="ftppasv/ftp-pasv-poc-v1.0.zip">http://bindshell.net/papers/ftppasv/ftp-pasv-poc-v1.0.zip</a></p>


<h2 id="toc4">Mozilla Fix Information</h2>
<p>The recommendation for Firefox to ignore the IP address sent in FTP PASV responses has been implemented in Firefox 2.0.0.3 and Firefox 1.5.0.11.</p>


<h2 id="toc5">Bug Numbers</h2>
<p>Bugtraq IDs <a href="http://www.securityfocus.com/bid/23082">23082</a>, <a href="http://www.securityfocus.com/bid/23089">23089</a></p>

<p>Mozilla Bugzilla Number <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=370559">370559</a></p>

<p>Mozilla Advisory <a href="http://www.mozilla.org/security/announce/2007/mfsa2007-11.html">2007-11</a></p>

<p>SecurityTracker IDs <a href="http://securitytracker.com/alerts/2007/Mar/1017802.html">1017802</a>, <a href="http://securitytracker.com/alerts/2007/Mar/1017801.html">1017801</a>, <a href="http://securitytracker.com/alerts/2007/Mar/1017800.html">1017800</a></p>


<h2 id="toc6">Some Follow Up</h2>
<p>Thanks to all those who have given feedback.  Here are some notes based on the what people have said:</p>

<p>Some notes on trying out the PoC code:<br />
<a href="http://www.mcgrewsecurity.com/blog/?p=8" onclick="window.open(this.href, '_self'); return false;">http://www.mcgrewsecurity.com/blog/?p=8</a></p>

<p>Another way to bypass Firefox port-banning for port 22:<br />
<a href="http://jeremiahgrossman.blogspot.com/2006/11/bypassing-mozilla-port-blocking.html" onclick="window.open(this.href, '_self'); return false;">http://jeremiahgrossman.blogspot.com/2006/11/bypassing-mozilla-port-blocking.html</a></p>

<p>A reason FTP clients might want to follow PASV responses to other IP addresses:<br />
<a href="http://www.drftpd.org/index.php/Distributed_PASV" onclick="window.open(this.href, '_self'); return false;">http://www.drftpd.org/index.php/Distributed_PASV</a></p>

<p>A method for portscanning from Firefox without using JavaScript.  This could be combined with other methods to bypass port banning.  Even <a href="https://addons.mozilla.org/firefox/722/">Noscript</a> users would be vulnerable then (to plain port-scanning, that is, not banner-grabbing):<br />
<a href="http://jeremiahgrossman.blogspot.com/2006/11/browser-port-scanning-without.html" onclick="window.open(this.href, '_self'); return false;">http://jeremiahgrossman.blogspot.com/2006/11/browser-port-scanning-without.html</a></p>

<p>Banner grabbing takes ages.  As soon as users browse away from the page, the scan stops.  Some sort of distraction on the page would be necessary in a real attack - maybe a flash movie or game.</p>

<p><div class="lastupdate">Last updated by Wade on 23-Apr-07 at 12:20pm</div></p>

	</div>
</div>

<a href="http://bindshell.net/login" accesskey="L" class="hidden"></a>
<!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
 xmlns:dc="http://purl.org/dc/elements/1.1/"
 xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
	<rdf:Description rdf:about="http://www.bindshell.net"
	 dc:identifier="http://www.bindshell.net"
	 dc:title="bindshell.net"
	 trackback:ping="http://bindshell.net/trackback" />
</rdf:RDF>
-->
</body>

<!-- Mirrored from bindshell.net/papers/ftppasv by HTTrack Website Copier/3.x [XR&CO'2010], Fri, 28 Jan 2011 12:56:45 GMT -->
</html>
