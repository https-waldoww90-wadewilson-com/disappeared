<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>cqure.net  &raquo; Blog Archive   &raquo; Detecting Apple Mac OS X AFP vulnerability CVE-2010-0533 with Nmap</title>

<meta name="generator" content="WordPress 3.4.1" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/cqure2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed/rss/index.html" />
<link rel="alternate" type="text/xml" title="RSS .92" href="feed/rss/index.html" />
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="feed/atom/index.html" />
<link rel="pingback" href="xmlrpc.php" />

	<link rel='archives' title='July 2012' href='2012/07/index.html' />
	<link rel='archives' title='May 2012' href='2012/05/index.html' />
	<link rel='archives' title='August 2011' href='2011/08/index.html' />
	<link rel='archives' title='June 2011' href='2011/06/index.html' />
	<link rel='archives' title='February 2011' href='2011/02/index.html' />
	<link rel='archives' title='January 2011' href='2011/01/index.html' />
	<link rel='archives' title='August 2010' href='2010/08/index.html' />
	<link rel='archives' title='May 2010' href='2010/05/index.html' />
	<link rel='archives' title='March 2010' href='2010/03/index.html' />
	<link rel='archives' title='February 2010' href='2010/02/index.html' />
	<link rel='archives' title='January 2010' href='2010/01/index.html' />
	<link rel='archives' title='December 2009' href='2009/12/index.html' />
	<link rel='archives' title='November 2009' href='2009/11/index.html' />
	<link rel='archives' title='October 2009' href='2009/10/index.html' />
	<link rel='archives' title='September 2009' href='2009/09/index.html' />
	<link rel='archives' title='May 2009' href='2009/05/index.html' />
	<link rel='archives' title='September 2008' href='2008/09/index.html' />
	<link rel='archives' title='August 2008' href='2008/08/index.html' />
	<link rel='archives' title='May 2008' href='2008/05/index.html' />
	<link rel='archives' title='April 2008' href='2008/04/index.html' />
	<link rel='archives' title='November 2007' href='2007/11/index.html' />
	<link rel='archives' title='October 2007' href='2007/10/index.html' />
	<link rel='archives' title='September 2007' href='2007/09/index.html' />
	<link rel='archives' title='August 2007' href='2007/08/index.html' />
	<link rel='archives' title='July 2007' href='2007/07/index.html' />
	<link rel='archives' title='March 2007' href='2007/03/index.html' />
	<link rel='archives' title='February 2007' href='2007/02/index.html' />
	<link rel='archives' title='January 2007' href='2007/01/index.html' />
	<link rel='archives' title='November 2006' href='2006/11/index.html' />
	<link rel='archives' title='October 2006' href='2006/10/index.html' />
	<link rel='archives' title='March 2006' href='2006/03/index.html' />
	<link rel='archives' title='February 2006' href='2006/02/index.html' />
	<link rel='archives' title='January 2006' href='2006/01/index.html' />

<link rel="alternate" type="application/rss+xml" title="cqure.net &raquo; Detecting Apple Mac OS X AFP vulnerability CVE-2010-0533 with Nmap Comments Feed" href="2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/feed/index.html" />
<link rel='stylesheet' id='A2A_SHARE_SAVE-css'  href='wp-content/plugins/add-to-any/addtoany.min.css?ver=1.4' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js?ver=3.4.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Inspect it is hiring' href='2010/03/inspect-it-is-hiring/trackback/index.html' />
<link rel='next' title='Updated rdesktop patch' href='2010/05/updated-rdesktop-patch/trackback/index.html' />
<link rel='canonical' href='2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/trackback/index.html' />
<link rel='shortlink' href='index.html?p=359' />

<script type="text/javascript"><!--
var a2a_config=a2a_config||{},wpa2a={done:false,html_done:false,script_ready:false,script_load:function(){var a=document.createElement('script'),s=document.getElementsByTagName('script')[0];a.type='text/javascript';a.async=true;a.src='http://static.addtoany.com/menu/page.js';s.parentNode.insertBefore(a,s);wpa2a.script_load=function(){};},script_onready:function(){if(a2a.type=='page'){wpa2a.script_ready=true;if(wpa2a.html_done)wpa2a.init();}},init:function(){for(var i=0,el,target,targets=wpa2a.targets,length=targets.length;i<length;i++){el=document.getElementById('wpa2a_'+(i+1));target=targets[i];a2a_config.linkname=target.title;a2a_config.linkurl=target.url;if(el)a2a.init('page',{target:el});wpa2a.done=true;}}};a2a_config.tracking_callback=['ready',wpa2a.script_onready];
//--></script>
<script type="text/javascript">
	swfobject.registerObject("wpFollowmeFlash", "9.0.0");
</script>
<style type="text/css">
	.getflash { font-size:8px; }
	.wp_followme_c2 {
		position:fixed;
		background:#59B7FF;
		top:200px;
		right:0px;
		width:32px;
		height:160px;
		border:1px solid #FFFFFF;
		color:#FFFFFF;
	}
</style>

<!--[if IE]>
<style type="text/css">
.addtoany_list a img{filter:alpha(opacity=70)}
.addtoany_list a:hover img,.addtoany_list a.addtoany_share_save img{filter:alpha(opacity=100)}
</style>
<![endif]-->
</head>
<body background="wp-content/themes/cqure2/images/eye.jpg">

<div class="title"><a href="../wp.1">cqure.net</a></div>
<div class="description"></div>
<div id="page">
<br>
<div class="top-ad">
<script type="text/javascript"><!--
google_ad_client = "pub-5587712415782238";
//Link unit below logo 728x15
google_ad_slot = "9173520977";
google_ad_width = 728;
google_ad_height = 15;
//--></script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

<!-- Start Obar -->

	<div class="obar">
<ul>

<script type="text/javascript"><!--
google_ad_client = "pub-5587712415782238";
//120x600, created 11/8/07
google_ad_slot = "9346871999";
google_ad_width = 120;
google_ad_height = 600;
//--></script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</ul>
	</div>

<!-- End Obar -->

	<div id="content" class="widecolumn">
				
  	
		<div class="navigation">
			<div class="alignleft">&laquo; <a href="2010/03/inspect-it-is-hiring/trackback/index.html" rel="prev">Inspect it is hiring</a></div>
			<div class="alignright"><a href="2010/05/updated-rdesktop-patch/trackback/index.html" rel="next">Updated rdesktop patch</a> &raquo;</div>
		</div>
	
		<div class="post" id="post-359">
			<h2><a href="2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/trackback/index.html" rel="bookmark" title="Permanent Link: Detecting Apple Mac OS X AFP vulnerability CVE-2010-0533 with Nmap">Detecting Apple Mac OS X AFP vulnerability CVE-2010-0533 with Nmap</a></h2>
	
			<div class="entrytext">
				<p>During the development of my AFP library for <a href="http://nmap.org">Nmap</a> I came a cross a critical vulnerability in Apple&#8217;s implementation of AFP on Snow Leopard. The vulnerability occurs due to improper input validation and allows an attacker to access (list, read, and/or write) files in the parent directory of any AFP sharepoint.</p>
<p><span id="more-359"></span>By default, when enabling AFP, the Public folder in each user&#8217;s home directory is shared as &lt;Usernames&gt; Public Folder. In my case &#8220;Patrik Karlsson&#8217;s Public Folder&#8221;. Since the Public folder is a subdirectory of a user&#8217;s home directory, exploiting this share provides access to all of that user&#8217;s home directory files (but not subdirectories or files with restrictive filesystem permissions).</p>
<p>As the name suggests, the Public shares are available to anyone without authentication. Given the default permissions on home directories (world read+execute) and the default umask (world read), this has a serious impact &#8211; as unauthenticated users can read all files in a user&#8217;s home directory. The attack also works for authenticated users against shares requiring authentication.</p>
<p>Technically the attack is not very challenging and relies on a classic directory traversal attack. It is strikingly similar to the famous Windows SMB filesharing <a href="http://seclists.org/bugtraq/1995/Jul/77">vulnerability</a> from 1995. However, sending such a path to the server without interpreting and translating it on the client is somewhat more challenging. I&#8217;ve developed a number of different scripts while researching the vulnerability that list, read and write files in the parent directory. In order to do so I&#8217;ve added the necessary code to the AFP library which is essentially the core of these NSE scripts.</p>
<p>At this time I&#8217;m releasing two scripts <a href="http://nmap.org/nsedoc/scripts/afp-path-vuln.html">afp-path-vuln</a>, <a href="http://nmap.org/nsedoc/scripts/afp-brute.html">afp-brute</a> and library. The vulnerability detection script attempts to determine whether the scanned servers are vulnerable or not and outputs the contents of the parent directory if they are. The script and library are as of now available from the latest <a href="http://nmap.org/book/install.html#inst-svn">subversion version of Nmap</a> and can also be downloaded here:</p>
<p><a href="http://nmap.org/svn/scripts/afp-path-vuln.nse">http://nmap.org/svn/scripts/afp-path-vuln.nse</a><br />
<a href="http://nmap.org/svn/scripts/afp-brute.nse">http://nmap.org/svn/scripts/afp-brute.nse</a><br />
<a href="http://nmap.org/svn/nselib/afp.lua">http://nmap.org/svn/nselib/afp.lua</a></p>
<p>You can run the scripts either from your current version of Nmap or from the current subversion release. If you want to run the script with user credentials it needs the subversion release of Nmap as adding the support for AFP authentication involved patching the LUA to OpenSSL API.</p>
<p>For documentation on how to add scripts to your current Nmap installation have a look at Ron Bowes blog post &#8220;How-to: install an Nmap script&#8221; over <a href="http://www.skullsecurity.org/blog/?p=459">here</a>. The afp.lua library should be copied to the nselib directory which is located in the same parent directory as the scripts directory described in the blog post.</p>
<p>Last, but not least, here is the syntax for running the scripts against a system or network to detect vulnerable hosts:</p>
<pre lang="bash">nmap -p 548 --script afp-path-vuln &lt;host or network&gt;</pre>
<p>If the server is vulnerable it will show the following output:</p>
<p>PORT    STATE SERVICE<br />
548/tcp open  afp<br />
| afp-path-vuln:<br />
|   Patrik&#8217;s Public Folder/../ (5 first items)<br />
|     .bash_history<br />
|     .bash_profile<br />
|     .CFUserTextEncoding<br />
|     .config/<br />
|     .crash_report_checksum<br />
|<br />
|_AFP path traversal (CVE-2010-0533): VULNERABLE</p>
<p><span style="text-decoration: underline;">Solution</span><br />
Apple has released Mac OS X 10.6.3 which addresses the vulnerability. It can be downloaded from here:<br />
<a href="http://support.apple.com/kb/HT1222">http://support.apple.com/kb/HT1222</a></p>
<p><span style="text-decoration: underline;">Credits</span><br />
Thanks to Fyodor and David Fifield for great suggestions, moral support, and review of the code.</p>
<p><span style="text-decoration: underline;">Timeline</span><br />
2010-02-10 &#8211; Security vulnerability disclosed to Apple together with PoC<br />
2010-02-10 &#8211; Apple responds and have been able to reproduce vulnerability<br />
2010-02-15 &#8211; Request of status update<br />
2010-02-18 &#8211; Request of status update<br />
2010-02-22 &#8211; Request of status update<br />
2010-02-22 &#8211; Apple responds with DRAFT advisory and timing for disclosure (week starting 02/28)<br />
2010-03-06 &#8211; Disclosure date overdue, request for status update<br />
2010-03-08 &#8211; Apple responds with a new date for disclosure (week starting 03/15)<br />
2010-03-17 &#8211; Request status update<br />
2010-03-17 &#8211; Apple responds with a new date for disclosure (week starting 03/23)<br />
2010-03-17 &#8211; Apple corrects the disclosure date to the 29th of March</p>
<div class="addtoany_share_save_container"><div class="a2a_kit a2a_target addtoany_list" id="wpa2a_1"><a class="a2a_dd addtoany_share_save" href="http://www.addtoany.com/share_save"><img src="wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div>
<script type="text/javascript"><!--
wpa2a.script_load();
//--></script>
</div>	
					
				<p class="postmetadata alt">
					<small>
						This entry was posted
						 
						on Monday, March 29th, 2010 at 1:53 pm						and is filed under <a href="category/tools/index.html" title="View all posts in tools" rel="category tag">tools</a>.
						You can follow any responses to this entry through the <a href='2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/feed/index.html'>RSS 2.0</a> feed. 
						
													You can <a href="2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/trackback/index.html#respond">leave a response</a>, or <a href="2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/trackback/index.html" rel="trackback">trackback</a> from your own site.
						
												
					</small>
				</p>
	
			</div>
		</div>
		
	
<!-- You can start editing here. -->

	<h3 id="comments">2 Responses to &#8220;Detecting Apple Mac OS X AFP vulnerability CVE-2010-0533 with Nmap&#8221;</h3> 

	<ol class="commentlist">

	
		<li class="alt" id="comment-485">
			<cite><a href='http://fz-corp.net/?p=538' rel='external nofollow' class='url'>Focus sur le nouvel Nmap | FZ Blog</a></cite> Says:
						<br />

			<small class="commentmetadata"><a href="2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/trackback/index.html#comment-485" title="">March 30th, 2010 at 1:54 pm</a> </small>

			<p>[...] différents scripts tournés vers la détection et l&#8217;attaque de la vulnérabilité critique AFP directory traversal (CVE-2010-0533) touchant tout récemment les ordinateurs à la pomme. Si cette vulnérabilité est toute récente [...]</p>

		</li>

	
	
		<li class="" id="comment-502">
			<cite><a href='http://www.lucertolealguinzaglio.com/public/molossiveloci/?p=5567' rel='external nofollow' class='url'>Hackmeeting - 2-3-4 Luglio 2010 - Roma &laquo; Utilitypc</a></cite> Says:
						<br />

			<small class="commentmetadata"><a href="2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/trackback/index.html#comment-502" title="">June 17th, 2010 at 12:45 am</a> </small>

			<p>[...] E se ci vedessimo li?  via Bertero13   &#8211; L&#8217;hackmeeting è a ingresso libero. All&#8217;entrata ci sarà una sottoscrizione libera per contribuire alle spese di organizzazione dei tre giorni e del warm-up.   it.hackmeeting.org   Non ci entra con quanto sopra ma e&#8217; un link che voglio condividere con chi ovviamente non lo conosce ancora&#8230; <a href="http://insecure.org" rel="nofollow">http://insecure.org</a> un articolo interessante a mo di esempio su cosa ci si puo&#8217; trovare detecting-apple-mac-os-x-afp-vulnerability [...]</p>

		</li>

	
	
	</ol>

 


<h3 id="respond">Leave a Reply</h3>

<p>You must be <a href="http://www.cqure.net/wp/wp-login.php?redirect_to=http://www.cqure.net/wp/2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/">logged in</a> to post a comment.</p>

	
		
	</div>


<hr />
<div id="footer">
	<p>
		cqure.net is proudly powered by 
		<a href="http://wordpress.org">WordPress</a>
		<br /><a href="feed:http://www.cqure.net/wp/feed/">Entries (RSS)</a>
		and <a href="feed:http://www.cqure.net/wp/comments/feed/">Comments (RSS)</a>.
		<!-- 16 queries. 2.371 seconds. -->
	</p>
</div>
</div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		
<script type="text/javascript"><!--
wpa2a.targets=[
{title:'Detecting Apple Mac OS X AFP vulnerability CVE-2010-0533 with Nmap',url:'http://www.cqure.net/wp/2010/03/detecting-apple-mac-os-x-afp-vulnerability-cve-2010-0533-with-nmap/'}];
wpa2a.html_done=true;if(wpa2a.script_ready&&!wpa2a.done)wpa2a.init();wpa2a.script_load();
//--></script>

<div style="position:relative;">
	<div class="wp_followme_c2">
		<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="32" height="160" id="wpFollowmeFlash">
			<param name="movie" value="http://www.cqure.net/wp/wp-content/plugins/wp-followme/flash/wp_followme.swf" />
			<param name="allowfullscreen" value="false" />
			<param name="allowscriptaccess" value="always" />
			<param name="flashvars" value="twit_icon=http://www.cqure.net/wp/wp-content/plugins/wp-followme/icons/1.png&amp;turl=http://twitter.com/nevdull77&amp;twitmsg=Follow Me&amp;twitmsgcolor=FFFFFF&amp;iconbgcolor=FFFFFF" />
			<param name="bgcolor" value="#59B7FF" />
			<!--[if !IE]>-->
			<object type="application/x-shockwave-flash" data="wp-content/plugins/wp-followme/flash/wp_followme.swf" width="32" height="160">
				<param name="allowfullscreen" value="false" />
				<param name="allowscriptaccess" value="always" />
				<param name="flashvars" value="twit_icon=http://www.cqure.net/wp/wp-content/plugins/wp-followme/icons/1.png&amp;turl=http://twitter.com/nevdull77&amp;twitmsg=Follow Me&amp;twitmsgcolor=FFFFFF&amp;iconbgcolor=FFFFFF" />
				<param name="bgcolor" value="#59B7FF" />
				<!--<![endif]-->
				<div class="getflash">
					<a rel="nofollow" href="http://www.adobe.com/go/getflashplayer"><img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" /></a>
									</div><!--[if !IE]>-->
			</object> <!--<![endif]-->
		</object>
	</div>
</div>


<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-3096101-2";
urchinTracker();
</script>

</body>
</html>
